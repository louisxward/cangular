services:
 frontend:
  container_name: front
  build: /opt/cangular
  networks:
   - app-network
  volumes:
   - dist:/app/dist
  command: ['ng', 'build']

 backend:
  container_name: back
  build: ../backend
  ports:
   - '8090:8090'
  volumes:
   - /opt/data:/pb/pb_data
  networks:
   - app-network

 nginx:
  container_name: proxy
  image: nginx:alpine
  volumes:
   - ./nginx.conf:/etc/nginx/conf.d/default.conf
   - /opt/static:/var/www/html/static
   - dist:/var/www/html/front
  ports:
   - '80:80'
  depends_on:
   - frontend
   - backend
  networks:
   - app-network

networks:
 app-network:
  driver: bridge

volumes:
 dist:
